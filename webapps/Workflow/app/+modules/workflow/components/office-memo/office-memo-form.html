<form class="form" *ngIf="isReady">
    <header class="content-header">
        <div class="content-actions">
            <button class="btn-back" type="button" (click)="close($event)">
                <i class="fa fa-chevron-left"></i>
                <span>{{'close' | translate}}</span>
            </button>
            <button class="btn btn-primary" type="button" *ngIf="canSave" [disabled]="!isValid" (click)="save()">
                {{'save_close' | translate}}
            </button>
            <div *ngIf="canDelete" dropdown class="buttons" [tabIndex]="-1">
                <div dropdown-toggle>
                    <span class="btn">...</span>
                </div>
                <div class="dropdown-menu">
                    <ul class="menu">
                        <li>
                            <a class="menu-item" (click)="delete()">{{'delete' | translate}}</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <h1 class="header-title">
            <div class="header-title-inner">
                <label class="header-title-label">{{'office_memo' | translate}}</label>
                <span class="header-reg-number" *ngIf="officeMemo.regNumber">{{officeMemo.regNumber}}</span>
            </div>
        </h1>
    </header>
    <section class="content-body">
        <tabs>
            <tab class="tab-pane" tabTitle="{{'properties' | translate}}">
                <div class="fieldset">
                    <div class="form-group">
                        <div class="control-label">
                            {{'approval' | translate}}
                        </div>
                        <div class="controls" [class.has-error]="errors.approval">
                            <selection
                                class="span8"
                                [selectedItems]="officeMemo.approval"
                                [url]="'/Workflow/approvals?'"
                                [listPath]="'objects.1.list'"
                                [totalPagesPath]="'objects.1.meta.totalPages'"
                                [disabled]="!isEditable"
                                [searchable]="true"
                                (change)="setApproval($event)">
                            </selection>
                            <error-message [error]="errors.approval"></error-message>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="control-label">
                            {{'applied_reg_date' | translate}}
                        </div>
                        <div class="controls" [class.has-error]="errors.appliedRegDate">
                            <div class="span2" *ngIf="!isEditable">
                                <span class="input">{{officeMemo.appliedRegDate}}</span>
                            </div>
                            <div class="span2" *ngIf="isEditable">
                                <input datepicker class="span2" name="appliedRegDate" (select)="setAppliedRegDate($event)" [(ngModel)]="officeMemo.appliedRegDate" />
                            </div>
                            <error-message [error]="errors.appliedRegDate"></error-message>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="control-label">
                            {{'summary' | translate}}
                        </div>
                        <div class="controls" [class.has-error]="errors.summary">
                            <textarea class="span8" name="approval" [(ngModel)]="officeMemo.summary"></textarea>
                            <error-message [error]="errors.summary"></error-message>
                        </div>
                    </div>
                    <div class="form-group" [class.has-error]="errors.content">
                        <div class="control-label">
                            {{'content' | translate}}
                        </div>
                        <div class="controls">
                            <markdown-editor
                                writeLabel="{{'markdown_write' | translate}}"
                                previewLabel="{{'markdown_preview' | translate}}"
                                [markdown]="officeMemo.content || ''"
                                [editable]="isEditable"
                                [updateTimeout]="300"
                                (update)="setContent($event)">
                            </markdown-editor>
                            <error-message [error]="errors.content"></error-message>
                        </div>
                    </div>
                </div>
                <attachments
                    [editable]="isEditable"
                    [model]="officeMemo"
                    (upload)="addAttachment($event)"
                    (delete)="deleteAttachment($event)">
                </attachments>
            </tab>
            <tab class="tab-pane" tabTitle="{{'execution' | translate}}" icon="fa fa-align-left" *ngIf="hasExecution">
                <!--<tasks [tasks]="[officeMemo]" [embedded]="true" [headerVisible]="false" [selectable]="false"></tasks>-->
            </tab>
            <tab class="tab-pane" tabTitle="{{'acl_tab_title' | translate}}" icon="fa fa-share-alt" *ngIf="officeMemo.acl">
                <acl [acl]="officeMemo.acl"></acl>
            </tab>
        </tabs>
    </section>
    <footer class="content-footer">
        <div class="record-author" *ngIf="officeMemo.authorId">
            <span>{{'author' | translate}}</span>
            <!--<employee-input [ids]="[officeMemo.authorId]"></employee-input>-->
            <span>{{officeMemo.regDate}}</span>
        </div>
    </footer>
</form>
